---
title: 드래프트
label: 드래프트
order: 20
desc: 컬렉션 문서나 글로벌에서 드래프트를 활성화하고 데이터를 위한 진정한 프리뷰 환경을 구축하세요.
keywords: version history, drafts, preview, draft, restore, publish, autosave, Content Management System, cms, headless, javascript, node, react, nextjs
---

Payload의 드래프트 기능은 버전 기능 위에 구축되어 컬렉션 문서와 글로벌에 변경을 가할 수 있지만 준비가 되었을 때만 게시할 수 있게 해줍니다. 이 기능을 통해 데이터를 위한 강력한 프리뷰 환경을 구축할 수 있으며, 문서를 게시하기 전에 변경 사항이 좋아 보이는지 확인할 수 있습니다.

<Banner type="warning">
  드래프트가 작동하려면 버전이 활성화되어 있어야 합니다.
</Banner>

드래프트와 함께 버전을 활성화하면, 컬렉션과 글로벌이 문서의 _더 새로운_, _게시되지 않은_ 버전을 유지할 수 있습니다. 문서 작업을 하고, 업데이트하고, 진행 상황을 저장하지만 반드시 즉시 공개적으로 게시하지 않으려는 경우에 완벽합니다. 드래프트는 프리뷰 구현을 구축할 때 매우 유용합니다.

![드래프트 활성화](/images/docs/drafts-enabled.png)
_드래프트가 활성화된 경우, 일반적인 저장 버튼이 드래프트를 저장하거나 변경 사항을 게시할 수 있는 새로운 액션으로 대체됩니다._

## 옵션

컬렉션과 글로벌 모두 드래프트 구성을 위한 동일한 옵션을 지원합니다. `versions.drafts`를 `true`로 설정하거나 객체를 전달하여 드래프트 속성을 구성할 수 있습니다.

| 드래프트 옵션      | 설명                                                                                                                                                      |
| ----------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `autosave`        | 문서가 편집되는 동안 진행 상황을 자동으로 저장하려면 `autosave`를 활성화하세요. 활성화하려면 `true`로 설정하거나 [옵션](/docs/versions/autosave)이 있는 객체를 전달하세요. |
| `schedulePublish` | 편집자가 미래에 게시/게시 취소 이벤트를 예약할 수 있도록 허용합니다. [자세히](#scheduled-publish)                                                               |
| `validate`        | 드래프트 문서를 저장할 때 검증하려면 `validate`를 `true`로 설정하세요. 기본값은 `false`입니다.                                                                             |

## 데이터베이스 변경사항

컬렉션이나 글로벌에서 드래프트를 활성화하면 Payload는 **자동으로 `_status`라는 새 필드를 스키마에 주입**합니다. `_status` 필드는 문서가 `draft` 또는 `published`로 설정되었는지 저장하기 위해 Payload에서 내부적으로 사용됩니다.

**관리 UI 상태 표시**

관리 UI 내에서 드래프트가 활성화된 경우 문서는 세 가지 "상태" 중 하나로 표시될 수 있습니다:

1. **드래프트** - 문서가 게시된 적이 없고 문서의 드래프트 버전만 존재하는 경우
1. **게시됨** - 문서가 게시되고 더 새로운 드래프트가 없는 경우
1. **변경됨** - 문서가 게시되었지만 더 새로운 드래프트가 있고 아직 게시되지 않은 경우

## 드래프트 API

<Banner type="success">
  컬렉션이나 글로벌에서 드래프트가 활성화된 경우, REST, GraphQL 및 로컬 API에
  중요하고 강력한 변경사항이 적용되어 드래프트와 라이브 문서 중 어느 것과
  상호 작용할지 지정할 수 있습니다.
</Banner>

#### 드래프트 업데이트 또는 생성

컬렉션이나 글로벌에서 드래프트를 활성화하면 REST, GraphQL 및 로컬 API의 `create` 및 `update` 작업은 **드래프트**를 생성하거나 업데이트하는지 또는 변경사항을 게시된 문서에 직접 보내는지 지정할 수 있는 `draft`라는 새 옵션을 노출합니다.

예를 들어:

```ts
// REST API
POST /api/your-collection?draft=true

// Local API
await payload.create({
  collection: 'your-collection',
  data: {
    // 여기에 데이터
  },
  draft: true, // 드래프트를 생성하려면 필요합니다
})

// GraphQL
mutation {
  createYourCollection(data: { ... }, draft: true) {
    // ...
  }
}
```

**필수 필드**

문서를 생성하거나 업데이트하는 동안 `draft`가 활성화된 경우, 불완전한 드래프트를 저장할 수 있도록 모든 필드가 필수가 아닌 것으로 간주됩니다.

`_status: "draft"`를 설정해도 필수 필드가 우회되지 않습니다. 이전 예제에서 보여준 것처럼 `draft: true`를 설정해야 합니다.

#### 드래프트 vs. 게시된 문서 읽기

`create` 및 `update` 작업의 `draft` 인수 외에도 `find` 및 `findByID` 작업에도 `draft` 인수가 노출됩니다.

문서를 읽는 동안 `draft`가 `true`로 설정되면 **더 새로운 드래프트가 있는 경우 Payload는 반환된 문서를 최신 드래프트로 자동 교체**합니다.

**예를 들어, 다음 시나리오를 살펴봅시다:**

1. 새 컬렉션 문서를 생성하고 즉시 게시합니다
1. 그런 다음 일부 업데이트를 하고 업데이트를 드래프트로 저장합니다
1. 그런 다음 추가 업데이트를 하고 더 많은 업데이트를 또 다른 드래프트로 저장합니다

여기서 메인 컬렉션에 있는 게시된 문서와 `_[collectionSlug]_versions` 데이터베이스 컬렉션에 있는 두 개의 _더 새로운_ 드래프트가 있게 됩니다.

`find` 또는 `findByID` 작업을 사용하여 생성된 문서를 단순히 가져오면 게시된 문서가 반환되고 드래프트는 무시됩니다.

하지만 `draft`를 `true`로 지정하면 Payload는 자동으로 게시된 문서의 콘텐츠를 가장 최근에 저장된 `version`의 콘텐츠로 교체합니다. 이 경우 위 시나리오에서 _두 개의_ 버전을 만들었으므로 Payload는 가장 새로운(두 번째) 드래프트의 데이터를 다시 보내고 문서가 게시된 버전 대신 가장 최근에 초안된 버전으로 나타납니다.

<Banner type="error">
  **중요:** `draft` 인수 자체만으로는 `_status: 'draft'`인 문서가
  API에서 반환되는 것을 제한하지 않습니다. `_status: 'draft'`인 문서가
  인증되지 않은 사용자에게 반환되는 것을 방지하려면 액세스 제어를
  사용해야 합니다. 이것이 어떻게 작동하는지에 대한 자세한 정보는
  아래를 읽어보세요.
</Banner>

## 컬렉션 드래프트를 볼 수 있는 사람 제어

<Banner type="warning">
  **드래프트** 기능을 사용하는 경우, 누가 드래프트를 볼 수 있고
  누가 게시된 문서만 볼 수 있는지 고려하는 것이 중요합니다. 다행히
  Payload는 이를 매우 간단하게 만들고 권한을 완전히 여러분의
  손에 맡깁니다.
</Banner>

#### 드래프트 액세스 제한

`read` [액세스 제어](../access-control/collections#read) 메서드를 사용하여 주어진 사용자가 검색할 수 있는 문서를 제한하는 [쿼리 제약 조건](/docs/queries/overview)을 단순히 반환함으로써 누가 문서의 드래프트를 볼 수 있는지 제한할 수 있습니다.

다음은 `_status` 필드를 활용하여 드래프트를 검색하려면 사용자가 로그인해야 하는 예제입니다:

```ts
import type { CollectionConfig } from 'payload'

export const Pages: CollectionConfig = {
  slug: 'pages',
  access: {
    read: ({ req }) => {
      // 로그인한 사용자가 있으면
      // 모든 문서를 검색할 수 있게 허용
      if (req.user) return true

      // 사용자가 없으면
      // 반환되는 문서를 제한하여
      // `_status`가 `published`와 같은 문서만 포함
      return {
        _status: {
          equals: 'published',
        },
      }
    },
  },
  versions: {
    drafts: true,
  },
  //.. 여기에 Pages 설정의 나머지 부분
}
```

<Banner type="warning">
  **기존 컬렉션에 버전을 추가하는 것에 대한 참고사항**

이미 문서가 있는 컬렉션이 있고 기존 문서를 이미 생성한 후에 드래프트 기능을
_선택하는_ 경우, 모든 기존 문서는 다시 저장할 때까지 _`_status` 필드가 없습니다_.
이 때문에 기존 컬렉션에 버전을 _추가하는_ 경우, 사용자가
**`_status`가 `"published"`와 같은** 문서와
**`_status`가 존재하지 않는** 문서 모두를 읽을 수 있도록
액세스 제어 함수를 작성하는 것이 좋습니다.

</Banner>

다음은 `_status`가 "published"와 같은 문서와 `_status`가 존재하지 않는 문서 모두에 액세스를 부여하는 [액세스 제어](../access-control/overview) 함수를 작성하는 방법의 예제입니다:

```ts
import type { CollectionConfig } from 'payload'

export const Pages: CollectionConfig = {
  slug: 'pages',
  access: {
    read: ({ req }) => {
      // 로그인한 사용자가 있으면
      // 모든 문서를 검색할 수 있게 허용
      if (req.user) return true

      // 사용자가 없으면
      // 반환되는 문서를 제한하여
      // `_status`가 `published`와 같은 문서
      // 또는 `_status`가 존재하지 않는 문서만 포함
      return {
        or: [
          {
            _status: {
              equals: 'published',
            },
          },
          {
            _status: {
              exists: false,
            },
          },
        ],
      }
    },
  },
  versions: {
    drafts: true,
  },
  //.. 여기에 Pages 설정의 나머지 부분
}
```

## 예약 게시

Payload는 미래에 게시/게시 취소 이벤트를 예약할 수 있는 기능을 제공합니다. 이는 특정 문서를 미래의 주어진 날짜에 "라이브로 전환"하도록 설정하거나, 반대로 특정 시간이 지나면 드래프트 상태로 되돌려야 하는 경우에 도움이 될 수 있습니다.

`versions.drafts.schedulePublish: true` 속성을 통해 컬렉션과 글로벌 모두에서 이 기능을 활성화할 수 있습니다.

<Banner type="warning">
  **중요:** 예약 게시/게시 취소를 활성화하려는 경우,
  Payload 앱이 [작업](/docs/jobs-queue/overview)을 처리하도록 설정되어 있는지
  확인해야 합니다. 이 기능은 백그라운드에서 작업을 생성하여 작동하며,
  작업이 사용 가능해진 후에 픽업됩니다. 작업을 실행할 메커니즘이
  없다면 예약된 게시/게시 취소 작업이 실행되지 않습니다.
</Banner>

## 드래프트 게시 취소

문서가 게시된 경우, Payload 관리 UI는 사이드바 상단에 현재 게시된 문서를 "게시 취소"하는 "게시 취소" 버튼을 표시하도록 업데이트됩니다. 이를 문서를 드래프트 상태로 "되돌리는" 방법으로 생각하세요. API 측면에서 이는 문서에 `_status: 'draft'`를 단순히 설정함으로써 수행됩니다.

## 게시된 상태로 되돌리기

문서가 게시되고 드래프트로 저장된 추가 변경사항이 있는 경우, Payload는 드래프트 변경사항을 거부하고 문서의 게시된 상태로 "되돌릴" 수 있는 사이드바 상단의 "게시된 상태로 되돌리기" 버튼을 표시합니다. 드래프트는 여전히 저장되지만 문서의 마지막으로 게시된 상태를 반영하는 새 버전이 생성됩니다.