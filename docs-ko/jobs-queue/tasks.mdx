---
title: Tasks
label: Tasks
order: 20
desc: Task는 Payload의 Jobs Queue 내에서 실행할 수 있는 별개의 함수 선언입니다.
keywords: jobs queue, application framework, typescript, node, react, nextjs
---

<Banner type="default">
  **"Task"**는 비즈니스 로직을 수행하고 입력과 출력이 모두 강타입으로 정의된
  함수 정의입니다.
</Banner>

Payload 구성에 Tasks를 등록한 다음, 이를 사용하는 [Jobs](/docs/jobs-queue/jobs)나 [Workflows](/docs/jobs-queue/workflows)를 생성할 수 있습니다. Tasks를 "하나의 특정한 일을 수행하는" 깔끔하고 격리된 "함수"로 생각하세요.

Payload Tasks는 실패할 경우 자동으로 재시도하도록 구성할 수 있으며, 이는 LLM이 비결정적 결과를 반환하여 재시도가 필요할 수 있는 AI 애플리케이션과 같은 "내구성" 워크플로우에 유용합니다.

Tasks는 Payload 구성의 `jobs.tasks` 배열에서 정의하거나 워크플로우 내에서 인라인으로 정의할 수 있습니다.

### 구성에서 tasks 정의

Payload 구성의 `jobs.tasks` 배열에 task를 추가하기만 하면 됩니다. task는 다음 필드들로 구성됩니다:

| 옵션            | 설명                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| --------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `slug`          | 이 job에 대한 슬러그 기반 이름을 정의합니다. 이 슬러그는 tasks와 workflows 모두에서 고유해야 합니다.                                                                                                                                                                                                                                                                                                                                                          |
| `handler`       | job 실행을 담당해야 하는 함수입니다. job 함수 파일에 대한 문자열 기반 경로나 job 함수 자체를 전달할 수 있습니다. job 내에서 큰 의존성을 사용하는 경우, Next.js 앱에서 큰 의존성을 번들링하는 것을 피하기 위해 문자열 경로를 전달하는 것을 선호할 수 있습니다. 문자열 경로를 전달하는 것은 작동하기 위해 정교한 빌드 파이프라인이 필요할 수 있는 고급 기능입니다. |
| `inputSchema`   | 입력 필드 스키마를 정의합니다 - Payload가 이 스키마에 대한 타입을 생성합니다.                                                                                                                                                                                                                                                                                                                                                                                 |
| `interfaceName` | interfaceName을 사용하여 이 task에 대해 생성되는 인터페이스의 이름을 변경할 수 있습니다. 기본적으로 이것은 "Task" + 대문자화된 task 슬러그입니다.                                                                                                                                                                                                                                                                                                          |
| `outputSchema`  | 출력 필드 스키마를 정의합니다 - Payload가 이 스키마에 대한 타입을 생성합니다.                                                                                                                                                                                                                                                                                                                                                                                 |
| `label`         | 이 task에 대한 사용자 친화적인 라벨을 정의합니다.                                                                                                                                                                                                                                                                                                                                                                                                              |
| `onFail`        | task가 실패할 경우 실행될 함수입니다.                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `onSuccess`     | task가 성공할 경우 실행될 함수입니다.                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `retries`       | 실패할 경우 이 단계를 재시도해야 하는 횟수를 지정합니다. 정의되지 않은 경우, task는 워크플로우에서 재시도를 상속하거나 재시도가 없습니다. 0인 경우, task는 재시도되지 않습니다. 기본적으로 정의되지 않습니다.                                                                                                                                                                                                                                           |

Task의 로직은 `handler`에서 정의되며, 이는 함수나 함수에 대한 경로로 정의할 수 있습니다. `handler`는 worker가 이 task를 포함하는 Job을 선택하면 실행됩니다.

정의한 대로 task의 출력을 포함해야 하는 `output` 키가 있는 객체를 반환해야 합니다.예시:

```ts
export default buildConfig({
  // ...
  jobs: {
    tasks: [
      {
        // 이 task를 최대 두 번까지 
        // 자동으로 재시도하도록 구성
        retries: 2,

        // 이것은 task의 고유 식별자입니다

        slug: 'createPost',

        // Task가 허용할 인수들입니다
        inputSchema: [
          {
            name: 'title',
            type: 'text',
            required: true,
          },
        ],

        // 함수가 출력해야 하는 속성들입니다
        outputSchema: [
          {
            name: 'postID',
            type: 'text',
            required: true,
          },
        ],

        // task가 호출될 때 실행되는 함수입니다
        handler: async ({ input, job, req }) => {
          const newPost = await req.payload.create({
            collection: 'post',
            req,
            data: {
              title: input.title,
            },
          })
          return {
            output: {
              postID: newPost.id,
            },
          }
        },
      } as TaskConfig<'createPost'>,
    ],
  },
})
```

Payload 구성에 직접 제공되는 함수로 핸들러를 정의하는 것 외에도, 핸들러가 정의된 _절대 경로_를 전달할 수도 있습니다. task에 큰 의존성이 있고 파일 시스템에 액세스할 수 있는 별도의 프로세스에서 jobs를 실행하려는 경우, 이는 Payload + Next.js 앱의 컴파일 속도를 빠르게 유지하고 최소한의 의존성을 갖도록 하는 편리한 방법일 수 있습니다.

이것은 특히 프로덕션에서나 Next.js 내에서 사용할 때(예: `/api/payload-jobs/run` 엔드포인트를 호출하여), 정교한 빌드 파이프라인이 필요할 수 있는 고급 기능임을 염두에 두세요. 핸들러 파일들을 별도로 트랜스파일하고 job이 실행될 때 같은 위치에서 사용 가능한지 확인해야 합니다. jobs를 실행하기 위해 엔드포인트를 사용하는 경우, Payload 구성에서 직접 핸들러를 함수로 정의하거나 Next.js 외부에서 import 경로 핸들러를 사용하는 것이 권장됩니다.

일반적으로 이것은 고급 사용 사례입니다. 다음과 같이 보일 것입니다:

`payload.config.ts:`

```ts
import { fileURLToPath } from 'node:url'
import path from 'path'

const filename = fileURLToPath(import.meta.url)
const dirname = path.dirname(filename)

export default buildConfig({
  jobs: {
    tasks: [
      {
        // ...
        // #createPostHandler는 `createPost.ts` 파일 내의 명명된 export입니다
        handler:
          path.resolve(dirname, 'src/tasks/createPost.ts') +
          '#createPostHandler',
      },
    ],
  },
})
```

그리고 `createPost` 파일 자체:

`src/tasks/createPost.ts:`

```ts
import type { TaskHandler } from 'payload'

export const createPostHandler: TaskHandler<'createPost'> = async ({
  input,
  job,
  req,
}) => {
  const newPost = await req.payload.create({
    collection: 'post',
    req,
    data: {
      title: input.title,
    },
  })
  return {
    output: {
      postID: newPost.id,
    },
  }
}
```

### task 복원 구성

기본적으로 task가 이전에 성공했고 워크플로우가 다시 실행되면, task는 다시 실행되지 않습니다. 대신 이전 task 실행의 출력이 반환됩니다. 이는 이미 성공한 tasks의 불필요한 재실행을 방지하기 위함입니다.

`retries.shouldRestore` 속성을 통해 이 동작을 구성할 수 있습니다. 이 속성은 boolean이나 함수를 허용합니다.

`shouldRestore`가 true로 설정되면, task는 이전에 실패한 경우에만 다시 실행됩니다. 이것이 기본 동작입니다.

`shouldRestore`가 false로 설정되면, task는 이전에 성공했더라도 다시 실행되며, 최대 재시도 횟수를 무시합니다.

`shouldRestore`가 함수인 경우, 함수의 반환값이 task를 다시 실행할지 여부를 결정합니다. 이는 더 복잡한 복원 로직에 사용할 수 있습니다. 예를 들어, task를 X번까지 다시 실행한 후 연속 실행에서는 복원하거나, 입력이 변경된 경우에만 task를 다시 실행할 수 있습니다.

예시:

```ts
export default buildConfig({
  // ...
  jobs: {
    tasks: [
      {
        slug: 'myTask',
        retries: {
          shouldRestore: false,
        },
        // ...
      } as TaskConfig<'myTask'>,
    ],
  },
})
```

예시 - 입력 데이터를 기반으로 task를 복원할지 여부를 결정:

```ts
export default buildConfig({
  // ...
  jobs: {
    tasks: [
      {
        slug: 'myTask',
        inputSchema: [
          {
            name: 'someDate',
            type: 'date',
            required: true,
          },
        ],
        retries: {
          shouldRestore: ({ input }) => {
            if (new Date(input.someDate) > new Date()) {
              return false
            }
            return true
          },
        },
        // ...
      } as TaskConfig<'myTask'>,
    ],
  },
})
```

## 중첩된 tasks

task `handler` 함수에 전달되는 `tasks` 또는 `inlineTask` 인수를 사용하여 기존 task 내에서 하위 tasks를 실행할 수 있습니다:

```ts
export default buildConfig({
  // ...
  jobs: {
    // 중첩된 tasks를 사용할 때는 `addParentToTaskLog`를 `true`로 설정하는 것이 권장됩니다. 그러면 부모 task가 task 로그에 포함됩니다
    // 이를 통해 task 실행에 대한 더 나은 관찰 가능성과 디버깅이 가능합니다
    addParentToTaskLog: true,
    tasks: [
      {
        slug: 'parentTask',
        inputSchema: [
          {
            name: 'text',
            type: 'text',
          },
        ],
        handler: async ({ input, req, tasks, inlineTask }) => {
          await inlineTask('Sub Task 1', {
            task: () => {
              // 무언가 수행
              return {
                output: {},
              }
            },
          })

          await tasks.CreateSimple('Sub Task 2', {
            input: { message: 'hello' },
          })

          return {
            output: {},
          }
        },
      } as TaskConfig<'parentTask'>,
    ],
  },
})
```